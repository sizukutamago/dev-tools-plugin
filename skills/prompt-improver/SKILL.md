---
name: prompt-improver
description: Collect feedback on task completion to improve prompts, CLAUDE.md, and skills. Use when the user says "improve prompts", "analyze feedback", "reflect on task", "/improve", or when Stop hook triggers for feedback collection. Enables continuous improvement loop for Claude Code configurations.
---

# Prompt Improver

ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åé›†ãƒ»åˆ†æã—ã€CLAUDE.md/SKILL/hooksã®ç¶™ç¶šçš„æ”¹å–„ã‚’æ”¯æ´ã™ã‚‹ã‚¹ã‚­ãƒ«ã€‚

## æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è‡ªå·±æ”¹å–„ãƒ«ãƒ¼ãƒ—                            â”‚
â”‚                                                             â”‚
â”‚   ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ â†’ Stop hook â†’ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›† â†’ ä¿å­˜         â”‚
â”‚                                â†“                            â”‚
â”‚   æ”¹å–„é©ç”¨ â† æ”¹å–„ææ¡ˆç”Ÿæˆ â† ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ â† è“„ç©ãƒ‡ãƒ¼ã‚¿        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### Step 1: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†ï¼ˆæ¡ä»¶ä»˜ãè‡ªå‹•ï¼‰

Stop hookã§ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã«**æ¡ä»¶ã‚’åˆ¤æ–­ã—ã¦**åé›†ã€‚

#### åé›†æ¡ä»¶ï¼ˆã„ãšã‚Œã‹ã«è©²å½“ã™ã‚‹å ´åˆã®ã¿ï¼‰

- Write/Edit/Bashã§å®Ÿè³ªçš„ãªã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’è¡Œã£ãŸ
- ã‚¹ã‚­ãƒ«ï¼ˆ/hearing, /architecture, /apiç­‰ï¼‰ã‚’ä½¿ç”¨ã—ãŸ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ä¿®æ­£æŒ‡ç¤ºãƒ»ä¸æº€ãƒ»æŒ‡æ‘˜ãŒã‚ã£ãŸ
- ã‚¨ãƒ©ãƒ¼ã‚„äºˆæœŸã—ãªã„å¤±æ•—ãŒç™ºç”Ÿã—ãŸ
- 3ã‚¹ãƒ†ãƒƒãƒ—ä»¥ä¸Šã®è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ãŸ

#### ã‚¹ã‚­ãƒƒãƒ—æ¡ä»¶ï¼ˆä»¥ä¸‹ã®ã¿ã®å ´åˆã¯åé›†ã—ãªã„ï¼‰

- è³ªå•ã¸ã®å›ç­”ãƒ»èª¬æ˜ã®ã¿
- git status/Read/Globç­‰ã®é–²è¦§æ“ä½œã®ã¿
- 1-2ã‚¿ãƒ¼ãƒ³ã®è»½å¾®ãªå¯¾è©±
- è¨­å®šç¢ºèªã‚„æƒ…å ±è¡¨ç¤ºã®ã¿

#### åé›†ã™ã‚‹æƒ…å ±

1. ã‚¿ã‚¹ã‚¯ã®è¦ç´„ã¨çµæœï¼ˆæˆåŠŸ/éƒ¨åˆ†æˆåŠŸ/å¤±æ•—ï¼‰
2. å•é¡Œç‚¹ã¨é–¢é€£ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ/SKILLã¸ã®ç´ä»˜ã‘
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®æŒ‡æ‘˜ï¼ˆã‚ã‚Œã°ï¼‰
4. æ”¹å–„ã®ç¤ºå”†

### Step 2: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ†æï¼ˆ/improveï¼‰

è“„ç©ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åˆ†æ:

```bash
# çµ±è¨ˆè¡¨ç¤º
./scripts/analyze_feedback.sh --stats

# ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
./scripts/analyze_feedback.sh

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ•ã‚£ãƒ«ã‚¿
./scripts/analyze_feedback.sh --target CLAUDE.md
```

### Step 3: æ”¹å–„ææ¡ˆãƒ»é©ç”¨

åˆ†æçµæœã‹ã‚‰å…·ä½“çš„ãªæ”¹å–„æ¡ˆã‚’ç”Ÿæˆ:

```bash
# æ”¹å–„ææ¡ˆç”Ÿæˆ
./scripts/generate_improvements.sh

# ãƒˆãƒªã‚¢ãƒ¼ã‚¸æ›´æ–°
./scripts/update_triage.sh fb-20260201-001 --status fixed --fix-ref "commit:abc123"
```

## ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

`~/.claude/feedback/` ã« YAML å½¢å¼ã§ä¿å­˜ã€‚è©³ç´°ã¯ [references/feedback_schema.md](references/feedback_schema.md) å‚ç…§ã€‚

### å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

```yaml
id: fb-20260201-001
created_at: 2026-02-01T12:00:00Z
task_summary: "èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£…"
outcome:
  success: false
  score: 0.6
  rationale: "åŸºæœ¬æ©Ÿèƒ½ã¯å‹•ä½œã™ã‚‹ãŒã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹æœªå¯¾å¿œ"
issues:
  - issue_id: issue-001
    type: prompt_unclear        # prompt_unclear | skill_incomplete | skill_incorrect | hook_missing | hook_incorrect | example_missing | pattern_missing | context_lost | misunderstanding | other
    description: "CLAUDE.mdã®æŒ‡ç¤ºãŒæ›–æ˜§ã§èª¤è§£ã—ãŸ"
    target:
      type: claude_md           # claude_md | skill | hook | command | agent | other
      path: ~/.claude/CLAUDE.md
      section: "## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„"
    severity: high              # critical | high | medium | low
```

### æ¨å¥¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

```yaml
context:
  skill_name: architecture
  skill_version: 1.2.0
  prompt_hash: abc123
  model: claude-opus-4-5-20251101

source: user                    # user | self | eval
user_feedback: "ã‚‚ã£ã¨å…·ä½“çš„ãªä¾‹ãŒæ¬²ã—ã‹ã£ãŸ"

proposed_actions:
  - scope: skill
    change_summary: "architectureã‚¹ã‚­ãƒ«ã«ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’è¿½åŠ "
    expected_impact: high
    effort: low

triage:
  status: open                  # open | triaged | in_progress | fixed | verified | wont_fix
  priority: high
  labels: [documentation, example]
```

## hooksè¨­å®š

### Stop hookï¼ˆã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†ï¼‰

`type: "command"` ã‚’ä½¿ç”¨ã—ã¦ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç¢ºå®Ÿã«åé›†ã€‚

#### 1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆé…ç½®

`~/.claude/scripts/collect_feedback.sh` ã‚’ä½œæˆï¼ˆå®Ÿè¡Œæ¨©é™ä»˜ä¸å¿…é ˆï¼‰ã€‚
ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‚’è¡Œã†:
- æ¨™æº–å…¥åŠ›ã‹ã‚‰ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆæƒ…å ±ã‚’å—ã‘å–ã‚‹
- åé›†æ¡ä»¶ã‚’åˆ¤å®šï¼ˆã‚³ãƒ¼ãƒ‰å¤‰æ›´æ•°ã€ãƒ„ãƒ¼ãƒ«ä½¿ç”¨æ•°ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ï¼‰
- æ¡ä»¶ã‚’æº€ãŸã™å ´åˆã®ã¿ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ

#### 2. settings.json ã«è¿½åŠ 

```json
{
  "hooks": {
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "~/.claude/scripts/collect_feedback.sh"
          }
        ]
      }
    ]
  }
}
```

#### åé›†æ¡ä»¶ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§åˆ¤å®šï¼‰

- Write/Edit/Bash ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ï¼ˆã‚³ãƒ¼ãƒ‰å¤‰æ›´ï¼‰ãŒã‚ã£ãŸ
- ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ãŒ3å›ä»¥ä¸Šï¼ˆè¤‡é›‘ãªã‚¿ã‚¹ã‚¯ï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸äº¤æ›ãŒ6å›ä»¥ä¸Šï¼ˆå®Ÿè³ªçš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰
- ãŸã ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸4å›æœªæº€ã¯ã‚¹ã‚­ãƒƒãƒ—

> **Note**: äº‹å‰ã«ä»¥ä¸‹ã‚’å®Ÿè¡Œ:
> ```bash
> mkdir -p ~/.claude/feedback ~/.claude/scripts
> chmod +x ~/.claude/scripts/collect_feedback.sh
> ```

#### è‡ªå‹•é€šçŸ¥æ©Ÿèƒ½

ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒé–¾å€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5ä»¶ï¼‰ä»¥ä¸Šæºœã¾ã‚‹ã¨ã€ã‚¿ã‚¹ã‚¯çµ‚äº†æ™‚ã«é€šçŸ¥ã‚’è¡¨ç¤º:

```
ğŸ“Š æœªå‡¦ç†ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: 7ä»¶ â†’ /improve ã§æ”¹å–„é©ç”¨
```

é–¾å€¤ã¯ç’°å¢ƒå¤‰æ•°ã§å¤‰æ›´å¯èƒ½:

```bash
export FEEDBACK_THRESHOLD=10  # 10ä»¶ä»¥ä¸Šã§é€šçŸ¥
```

## ä½¿ç”¨ä¾‹

### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†ã®æµã‚Œï¼ˆåé›†ã•ã‚Œã‚‹å ´åˆï¼‰

```
User: "èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦"

Claude: [å®Ÿè£…ä½œæ¥­... Write/Edit ã§è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´]

[ã‚¿ã‚¹ã‚¯å®Œäº† â†’ Stop hookç™ºç« â†’ åé›†æ¡ä»¶ã«è©²å½“]

Claude: æŒ¯ã‚Šè¿”ã‚Šã‚’å®Ÿè¡Œã—ã¾ã™...
- çµæœ: éƒ¨åˆ†æˆåŠŸï¼ˆåŸºæœ¬æ©Ÿèƒ½OKã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹æœªå¯¾å¿œï¼‰
- å•é¡Œ: architectureã‚¹ã‚­ãƒ«ã«JWTèªè¨¼ã®å…·ä½“ä¾‹ãŒãªã‹ã£ãŸ
- æ”¹å–„æ¡ˆ: skills/architecture/SKILL.md ã«èªè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹ã‚’è¿½åŠ 

ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ä¿å­˜ã—ã¾ã—ãŸ: ~/.claude/feedback/fb-20260201-001.yaml
```

### ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹å ´åˆ

```
User: "git status è¦‹ã›ã¦"

Claude: [git status å®Ÿè¡Œã€çµæœè¡¨ç¤º]

[ã‚¿ã‚¹ã‚¯å®Œäº† â†’ Stop hookç™ºç« â†’ ã‚¹ã‚­ãƒƒãƒ—æ¡ä»¶ã«è©²å½“]

ï¼ˆä½•ã‚‚å‡ºåŠ›ã›ãšçµ‚äº†ï¼‰
```

### æ”¹å–„åˆ†æã®å®Ÿè¡Œ

```
User: "/improve"

Claude: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åˆ†æã—ã¾ã™...

ã€é »å‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
1. "å…·ä½“ä¾‹ä¸è¶³" - 5ä»¶ï¼ˆarchitecture, api, databaseï¼‰
2. "æ›–æ˜§ãªæŒ‡ç¤º" - 3ä»¶ï¼ˆCLAUDE.mdï¼‰

ã€å„ªå…ˆæ”¹å–„å¯¾è±¡ã€‘
1. skills/architecture/SKILL.md
   - å•é¡Œ: èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¾‹ãŒä¸è¶³
   - ææ¡ˆ: JWT/OAuth2ã®å®Ÿè£…ä¾‹ã‚’è¿½åŠ 
   - å½±éŸ¿åº¦: high / å·¥æ•°: low

2. ~/.claude/CLAUDE.md
   - å•é¡Œ: "é©åˆ‡ã«å‡¦ç†"ãªã©ã®æ›–æ˜§è¡¨ç¾
   - ææ¡ˆ: å…·ä½“çš„ãªåˆ¤æ–­åŸºæº–ã‚’æ˜è¨˜
   - å½±éŸ¿åº¦: medium / å·¥æ•°: medium
```

## ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `/improve` | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ†æã¨æ”¹å–„ææ¡ˆã‚’å®Ÿè¡Œ |
| `/improve --stats` | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯çµ±è¨ˆã‚’è¡¨ç¤º |

> Note: æ”¹å–„é©ç”¨ã¯ AskUserQuestion ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«å®Ÿæ–½

## ä¾å­˜é–¢ä¿‚

æ¨™æº–Unixãƒ„ãƒ¼ãƒ«ã®ã¿ï¼ˆè¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ï¼‰:
- bash, awk, grep, sed, date, sort, uniq, head, stat, mv, mkdir

## ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ³¨æ„

âš ï¸ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¨˜éŒ²æ™‚ã®æ³¨æ„:
- APIã‚­ãƒ¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç­‰ã®ç§˜å¯†æƒ…å ±ã¯è¨˜éŒ²ã—ãªã„
- å¿…è¦ã«å¿œã˜ã¦ `privacy.redacted: true` ã‚’è¨­å®š
- å€‹äººæƒ…å ±ã¯ä¼ã›å­—ã«ã™ã‚‹

## ãƒªã‚½ãƒ¼ã‚¹

### scripts/

- `collect_feedback.sh`: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†ãƒ»ä¿å­˜ï¼ˆåŸå­çš„IDç”Ÿæˆï¼‰
- `analyze_feedback.sh`: ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æï¼ˆ--stats, --targetå¯¾å¿œï¼‰
- `generate_improvements.sh`: æ”¹å–„ææ¡ˆç”Ÿæˆ
- `update_triage.sh`: ãƒˆãƒªã‚¢ãƒ¼ã‚¸ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼ˆtriageæœªè¨­å®šæ™‚ã¯è‡ªå‹•è¿½åŠ ï¼‰
- `archive_feedback.sh`: æ”¹å–„æ¸ˆã¿/å¤ã„ãƒ­ã‚°ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

### ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ©Ÿèƒ½

æ”¹å–„æ¸ˆã¿ã‚„å¤ã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æ•´ç†:

```bash
# fixed/verified/wont_fix ã‚’ã™ã¹ã¦ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
./scripts/archive_feedback.sh --all-fixed

# verified ã®ã¿ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
./scripts/archive_feedback.sh --status verified

# 30æ—¥ä»¥ä¸Šå¤ã„ãƒ­ã‚°ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
./scripts/archive_feedback.sh --older-than 30

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆç¢ºèªã®ã¿ï¼‰
./scripts/archive_feedback.sh --all-fixed --dry-run
```

ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å…ˆ: `~/.claude/feedback/archive/`

### references/

- `feedback_schema.md`: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

### assets/

- `hooks/stop_hook.json`: Stop hookè¨­å®šä¾‹
