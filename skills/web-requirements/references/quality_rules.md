# Quality Rules

品質ルール（曖昧語リスト、禁則ルール、P0 判定条件）。

## 曖昧語リスト

### 日本語

#### 程度を表す曖昧語

| 曖昧語 | 改善例 |
|--------|--------|
| 適切に | 「3 秒以内に」「エラーメッセージを表示して」 |
| 適宜 | 「ユーザーの設定に従って」「デフォルト値として X を使用」 |
| 十分に | 「100 件以上」「テストカバレッジ 80% 以上」 |
| 妥当な | 「1-100 の範囲で」「RFC 5322 に準拠した」 |
| 合理的に | 「5 秒以内に」「3 回のリトライ後に」 |

#### 頻度を表す曖昧語

| 曖昧語 | 改善例 |
|--------|--------|
| 定期的に | 「毎日 0:00 に」「1 時間ごとに」 |
| 必要に応じて | 「エラー発生時に」「ユーザーがリクエストした場合に」 |
| 随時 | 「リアルタイムで」「5 分以内に」 |
| 時々 | 「週に 1 回」「100 リクエストごとに」 |

#### 範囲を表す曖昧語

| 曖昧語 | 改善例 |
|--------|--------|
| など | 網羅的に列挙する「A, B, C」 |
| 等 | 網羅的に列挙する |
| その他 | 具体的に列挙するか、カテゴリで定義 |
| 各種 | 具体的に列挙する |
| いくつかの | 「3 種類の」「最大 5 件の」 |

#### 量を表す曖昧語

| 曖昧語 | 改善例 |
|--------|--------|
| 多い | 「100 件以上」 |
| 少ない | 「10 件未満」 |
| 大量の | 「1000 件以上」「10MB 以上」 |
| 少量の | 「100 件未満」「1MB 未満」 |

#### 時間を表す曖昧語

| 曖昧語 | 改善例 |
|--------|--------|
| 速やかに | 「3 秒以内に」 |
| すぐに | 「1 秒以内に」「即座に」 |
| 早く | 「3 秒以内に」「当日中に」 |
| 遅く | 「翌営業日以降に」 |

#### 品質を表す曖昧語

| 曖昧語 | 改善例 |
|--------|--------|
| 高品質 | 「エラー率 0.1% 未満」「テストカバレッジ 90% 以上」 |
| 使いやすい | 「3 クリック以内で完了」「ヘルプなしで操作可能」 |
| 見やすい | 「コントラスト比 4.5:1 以上」「フォントサイズ 16px 以上」 |
| シンプルな | 「入力項目 5 つ以下」「1 画面で完結」 |

### 英語

#### Degree

| Ambiguous | Improvement |
|-----------|-------------|
| appropriate | "within 3 seconds", "displaying error message" |
| adequate | "at least 100 items", "80% or higher" |
| proper | "following RFC 5322", "according to schema" |

#### Frequency

| Ambiguous | Improvement |
|-----------|-------------|
| periodically | "every hour", "daily at midnight" |
| as needed | "on error", "when user requests" |
| regularly | "every 5 minutes", "weekly" |

#### Range

| Ambiguous | Improvement |
|-----------|-------------|
| etc | List exhaustively: "A, B, C" |
| and so on | List all items |
| various | Enumerate specifically |
| some | "3 types", "up to 5 items" |

#### Quantity

| Ambiguous | Improvement |
|-----------|-------------|
| many | "100 or more" |
| few | "less than 10" |
| lots of | "1000 or more" |

#### Time

| Ambiguous | Improvement |
|-----------|-------------|
| quickly | "within 3 seconds" |
| soon | "within 1 second" |
| fast | "under 500ms" |

#### Quality

| Ambiguous | Improvement |
|-----------|-------------|
| high-quality | "error rate under 0.1%" |
| user-friendly | "completable in 3 clicks" |
| intuitive | "no training required" |

## 禁則ルール

### 実装詳細の規定

以下のような実装詳細を含むストーリーは NG:

| NG 例 | 理由 | 改善例 |
|-------|------|--------|
| 「React コンポーネントで表示する」 | 技術選定を限定 | 「画面に表示する」 |
| 「REST API を呼び出す」 | 通信方式を限定 | 「データを取得する」 |
| 「PostgreSQL に保存する」 | DB を限定 | 「永続化する」 |
| 「Redis でキャッシュする」 | キャッシュ実装を限定 | 「高速に取得できる」 |

### 複合アクション

When 句に複数のアクションを含めない:

| NG 例 | 改善例 |
|-------|--------|
| 「ユーザー名を入力してパスワードを入力してログインボタンをクリック」 | 「フォームに入力してログインボタンをクリック」 |
| 「商品を選択してカートに入れて決済画面に進む」 | 3 つの AC に分割 |

### 観測不可能な結果

Then 句に観測不可能な結果を含めない:

| NG 例 | 理由 | 改善例 |
|-------|------|--------|
| 「データベースに保存される」 | 外部から観測不可 | 「保存完了メッセージが表示される」 |
| 「キャッシュされる」 | 内部状態 | 「2 回目のアクセスが 100ms 以内で完了する」 |
| 「ログに記録される」 | 通常は観測不可 | 「監査ログ画面に記録が表示される」 |

### 主観的な結果

| NG 例 | 理由 | 改善例 |
|-------|------|--------|
| 「ユーザーが満足する」 | 測定不可 | 「タスクが完了する」「NPS スコア 8 以上」 |
| 「使いやすいと感じる」 | 主観的 | 「ヘルプなしで操作を完了できる」 |
| 「美しく表示される」 | 主観的 | 「デザインガイドラインに準拠する」 |

## P0 判定条件（各 Reviewer 共通）

### reviewer:completeness

| 条件 | 説明 |
|------|------|
| ペルソナ未定義 | ペルソナセクションが存在しない、または 0 件 |
| AC 欠落 | ストーリーに AC が 1 つもない |
| 構造欠損 | As a / I want / So that のいずれかが欠落 |
| 未定義参照 | 存在しないペルソナ ID を参照 |

### reviewer:consistency

| 条件 | 説明 |
|------|------|
| ID 重複 | US-ID または AC-ID が重複 |
| 参照切れ | 存在しない ID への参照 |
| 論理矛盾 | A かつ ¬A（明確な矛盾） |

### reviewer:quality

| 条件 | 説明 |
|------|------|
| 曖昧語過多 | 同一ストーリーに曖昧語が 3 件以上 |
| 価値不明 | So that が空または意味不明 |
| テスト不可 | AC がテスト不可能（主観的、非決定的） |

### reviewer:testability

| 条件 | 説明 |
|------|------|
| テスト不可能 AC | 主観的結果、非決定的結果 |
| Given 欠落 | 前提条件が全くない |
| Then 欠落 | 期待結果が全くない |
| 観測不可能 | 結果が外部から観測できない |

### reviewer:nfr

| 条件 | 説明 |
|------|------|
| セキュリティ脆弱性 | 明らかな脆弱性を許容する AC |
| PII 漏洩リスク | 個人情報の平文保存を示唆 |
| 認証バイパス | 認証なしで機密操作を許可 |
| a11y 重大違反 | WCAG A レベルの重大違反（操作不能） |

## P1 判定条件

### 2 件以上で差し戻し

| Reviewer | 条件 |
|----------|------|
| completeness | 失敗系 AC なし、非目標セクション空、成功指標未定義 |
| consistency | 用語不統一（3 箇所以上）、横断的矛盾、数値不一致 |
| quality | 曖昧語 5 件以上、巨大ストーリー（AC 10 個以上）|
| testability | 境界条件 AC なし、Given 曖昧 |
| nfr | セキュリティ要件欠落、a11y 考慮なし、パフォーマンス目標なし |

## P2 判定条件

### 要対応リスト（通過）

| Reviewer | 条件 |
|----------|------|
| completeness | 境界条件 AC 不足、Epic 紐づけなし |
| consistency | 軽微な用語揺れ、フォーマット不統一 |
| quality | 軽微な曖昧語、弱いアクション動詞 |
| testability | 一部境界条件欠落、テストデータ例なし |
| nfr | 一部 NFR 未定義、詳細度不足 |
