# テンプレート記入例

本ドキュメントは、各テンプレートのプレースホルダーに対する具体的な記入例を示す。

---

## 目次

1. [プレースホルダーの凡例](#プレースホルダーの凡例)
2. [プロジェクト情報の例](#プロジェクト情報の例)
3. [機能要件の例](#機能要件の例)
4. [非機能要件の例](#非機能要件の例)
5. [画面設計の例](#画面設計の例)
6. [API設計の例](#api設計の例)
7. [エンティティ定義の例](#エンティティ定義の例)
8. [ADRの例](#adrの例)
9. [キャッシュ戦略の例](#キャッシュ戦略の例)

---

## プレースホルダーの凡例

テンプレート内のプレースホルダーは `{{PLACEHOLDER}}` 形式で記載している。

| 形式 | 説明 |
|------|------|
| `{{PROJECT_NAME}}` | プロジェクト固有の値に置換 |
| `{{VERSION}}` | バージョン番号（例: 1.0.0） |
| `{{STATUS}}` | ステータス（DRAFT / REVIEW / APPROVED） |
| `{{DATE}}` | 日付（YYYY-MM-DD形式） |
| `{{AUTHOR}}` | 作成者名 |

---

## プロジェクト情報の例

### project_overview.md

| プレースホルダー | 記入例 |
|-----------------|--------|
| `{{PROJECT_NAME}}` | ECサイトリニューアルプロジェクト |
| `{{PHASE}}` | 設計フェーズ |
| `{{PROGRESS}}` | 45 |
| `{{PROJECT_DESCRIPTION}}` | 既存ECサイトのUI/UX改善とパフォーマンス向上を目的としたフルリニューアルプロジェクト |
| `{{BUSINESS_GOALS}}` | 売上20%向上、カート離脱率30%削減 |

---

## 機能要件の例

### functional_requirements.md

| プレースホルダー | 記入例 |
|-----------------|--------|
| `{{FR_001_NAME}}` | 商品検索機能 |
| `{{FR_001_CATEGORY}}` | 検索 |
| `{{FR_001_PRIORITY}}` | 必須 |
| `{{FR_001_STATUS}}` | Approved |
| `{{FR_001_SC}}` | SC-040 |
| `{{FR_001_API}}` | API-040 |

### 機能詳細の記入例

```markdown
### FR-001: 商品検索機能

| 項目 | 内容 |
|------|------|
| 機能ID | FR-001 |
| 機能名 | 商品検索機能 |
| カテゴリ | 検索 |
| 優先度 | 必須 |
| ステータス | Approved |

#### 概要

ユーザーがキーワードや条件を指定して商品を検索できる機能。

#### ユーザーストーリー

> 購入者として、欲しい商品を素早く見つけるために、キーワードで商品を検索したい。

#### 詳細仕様

- キーワード検索（商品名、説明文を対象）
- カテゴリフィルター
- 価格帯フィルター
- 並び替え（新着順、価格順、人気順）

#### 受入基準

- [ ] キーワード入力後、1秒以内に検索結果が表示される
- [ ] 検索結果が0件の場合、適切なメッセージが表示される
- [ ] フィルター適用時、即座に結果が更新される

#### 関連情報

| 項目 | 値 |
|------|-----|
| 関連画面 | SC-040, SC-002 |
| 関連API | API-040 |
| 関連エンティティ | ENT-Item, ENT-Category |
```

---

## 非機能要件の例

### non_functional_requirements.md

| プレースホルダー | 記入例 |
|-----------------|--------|
| `{{目標値1}}` | 1.5秒以内 |
| `{{測定条件1}}` | 3G回線環境下 |
| `{{ACCESS_TOKEN_EXPIRY}}` | 15分 |
| `{{REFRESH_TOKEN_EXPIRY}}` | 7日 |
| `{{AVAILABILITY}}` | 99.9% |

### パフォーマンス要件の記入例

```markdown
### NFR-PERF-001: 画面応答時間

| 項目 | 内容 |
|------|------|
| 要件ID | NFR-PERF-001 |
| 要件名 | 画面応答時間 |
| 優先度 | 必須 |

#### 概要

ユーザー操作に対する画面の応答時間を規定する。

#### 目標値

| 項目 | 目標値 | 測定条件 |
|------|--------|----------|
| 初期表示（FCP） | 1.5秒以内 | 4G回線環境下 |
| 操作応答（TTI） | 3.0秒以内 | 4G回線環境下 |
| API応答 | 500ms以内 | サーバー処理時間 |

#### 測定方法

Lighthouse、WebPageTestを使用して測定。

#### 例外条件

大量データ（1000件以上）の一括処理時は5秒以内を許容。
```

---

## 画面設計の例

### screen_list.md

| プレースホルダー | 記入例 |
|-----------------|--------|
| `{{画面名_JP}}` | トップページ |
| `{{画面名_EN}}` | TopPage |
| `{{カテゴリ}}` | Public |
| `{{目的}}` | サイトのエントリーポイント |
| `{{FR-XXX}}` | FR-001 |
| `{{アクセス権限}}` | 全ユーザー |

### screen_detail_template.md

| プレースホルダー | 記入例 |
|-----------------|--------|
| `{{URL_PATH}}` | /products |
| `{{認証要否}}` | 不要 |
| `{{ELEM_ID}}` | search-input |
| `{{要素名}}` | 検索入力欄 |
| `{{種別}}` | input |
| `{{必須}}` | - |
| `{{データソース}}` | ユーザー入力 |

---

## API設計の例

### api_design.md

| プレースホルダー | 記入例 |
|-----------------|--------|
| `{{VERSIONING_FORMAT}}` | URLパスにバージョンを含める（/api/v1/） |
| `{{CURRENT_VERSION}}` | v1 |
| `{{ENDPOINT_RULE}}` | kebab-case、複数形名詞 |
| `{{ENDPOINT_EXAMPLE}}` | /api/v1/products |
| `{{QUERY_RULE}}` | snake_case |
| `{{QUERY_EXAMPLE}}` | page_size, sort_by |

### API詳細の記入例

```markdown
### API-040: GET /api/v1/products/search

| 項目 | 内容 |
|------|------|
| API ID | API-040 |
| メソッド | GET |
| エンドポイント | /api/v1/products/search |
| 概要 | 商品検索 |
| 認証 | 不要 |
| 関連FR | FR-001 |

#### リクエスト

##### クエリパラメータ

| パラメータ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|-----------|------|
| q | string | ○ | - | 検索キーワード |
| category_id | string | - | - | カテゴリID |
| min_price | number | - | - | 最低価格 |
| max_price | number | - | - | 最高価格 |
| page | number | - | 1 | ページ番号 |
| page_size | number | - | 20 | 1ページあたりの件数 |

#### レスポンス

##### 成功時（200）

{
  "data": [
    {
      "id": "prod_001",
      "name": "商品名",
      "price": 1000,
      "imageUrl": "https://..."
    }
  ],
  "pagination": {
    "currentPage": 1,
    "totalPages": 10,
    "totalItems": 200
  }
}
```

---

## エンティティ定義の例

### data_structure.md

```markdown
### ENT-Item

| 項目 | 内容 |
|------|------|
| エンティティID | ENT-Item |
| 説明 | 商品情報を表すエンティティ |

#### 型定義

interface Item {
  id: string;
  name: string;
  description: string;
  price: number;
  categoryId: string;
  imageUrls: string[];
  isAvailable: boolean;
  createdAt: string;
  updatedAt: string;
}

#### フィールド詳細

| フィールド | 型 | 必須 | 説明 | 制約 |
|-----------|-----|------|------|------|
| id | string | ○ | 商品ID | UUID形式 |
| name | string | ○ | 商品名 | 1-100文字 |
| description | string | ○ | 商品説明 | 1-2000文字 |
| price | number | ○ | 価格 | 0以上の整数 |
| categoryId | string | ○ | カテゴリID | 存在するカテゴリ |
| imageUrls | string[] | ○ | 画像URL | 1-10件 |
| isAvailable | boolean | ○ | 販売可否 | - |
```

---

## ADRの例

### adr.md

```markdown
### ADR-0001: フロントエンドフレームワークの選定

| 項目 | 内容 |
|------|------|
| ADR ID | ADR-0001 |
| ステータス | Accepted |
| 日付 | 2024-01-15 |

#### コンテキスト

新規Webアプリケーション開発にあたり、フロントエンドフレームワークを選定する必要がある。チームのスキルセット、プロジェクトの要件、長期的なメンテナンス性を考慮する。

#### 決定

Next.js（App Router）を採用する。

#### 理由

- チーム内にReact経験者が多い
- SSR/SSGによるSEO対応が可能
- Vercelとの親和性が高くデプロイが容易
- 活発なコミュニティとエコシステム

#### 代替案

| 代替案 | 却下理由 |
|--------|----------|
| Nuxt.js | Vueの経験者が少ない |
| SvelteKit | エコシステムが未成熟 |
| Remix | 学習コストが高い |

#### 影響

- 状態管理ライブラリの選定が必要（React向け）
- スタイリングはTailwind CSSとの組み合わせを推奨
- APIルートを活用したBFF構成が可能
```

---

## 補足

各テンプレートを使用する際は、上記の例を参考にプロジェクト固有の内容に置き換えること。プレースホルダーが残っている状態でのドキュメント完成とはみなさない。

---

## キャッシュ戦略の例

### cache_strategy.md（ECサイトを想定）

```markdown
# キャッシュ戦略設計書

## 設計方針

| 項目 | 内容 |
|------|------|
| 基本方針 | ユーザー体験向上とサーバー負荷軽減の両立 |
| 目標ヒット率 | 85%以上 |
| 関連NFR | NFR-PERF-001, NFR-PERF-002 |
| 関連ADR | ADR-0003 |

## レイヤー別キャッシュ設計

### ブラウザキャッシュ

| 項目 | 設定 |
|------|------|
| 対象 | 静的アセット、商品画像 |
| Cache-Control | public, max-age=31536000, immutable（ハッシュ付きファイル） |
| ETag | 弱いETag（W/"xxx"）を使用 |

#### 静的アセット

| アセット種別 | max-age | 更新戦略 |
|-------------|---------|----------|
| JS/CSS（ハッシュ付き） | 1年 | ファイル名にハッシュを含める |
| 商品画像 | 1年 | URLにバージョンパラメータ |
| HTMLページ | 0（no-cache） | 毎回サーバーで検証 |
| フォント | 1年 | 変更なし |

### CDNキャッシュ

| 項目 | 設定 |
|------|------|
| プロバイダー | Amazon CloudFront |
| キャッシュ対象 | 静的ファイル、商品一覧API |
| TTL | 静的: 1日、API: 5分 |

#### キャッシュルール

| パス | キャッシュ | TTL | 備考 |
|------|----------|-----|------|
| /static/* | ○ | 1年 | ハッシュ付きファイル |
| /images/* | ○ | 1日 | 商品画像 |
| /api/v1/products | ○ | 5分 | 商品一覧（Vary: Accept-Encoding） |
| /api/v1/products/{id} | ○ | 5分 | 商品詳細 |
| /api/v1/cart | × | - | ユーザー固有データ |
| /api/v1/user/* | × | - | 認証必須API |

### アプリケーションキャッシュ

| 項目 | 設定 |
|------|------|
| 技術 | Redis 7.x（ElastiCache） |
| 用途 | セッション、APIレスポンス、計算結果 |
| メモリ上限 | 4GB |

#### キャッシュ対象

| データ種別 | TTL | 優先度 | 理由 |
|-----------|-----|--------|------|
| セッションデータ | 24時間 | 高 | 認証状態の維持 |
| 商品マスタ | 1時間 | 高 | 頻繁にアクセス、更新頻度低 |
| カテゴリ一覧 | 1時間 | 高 | 変更頻度が低い |
| 検索結果 | 5分 | 中 | 人気キーワードのみ |
| 在庫数 | 30秒 | 低 | リアルタイム性が重要 |
| レコメンド結果 | 15分 | 中 | 計算コストが高い |

### データベースキャッシュ

| 項目 | 設定 |
|------|------|
| クエリキャッシュ | 無効（MySQL 8.0以降非推奨） |
| リードレプリカ | 2台（読み取り負荷分散） |

## キャッシュキー設計

### 命名規則

| パターン | 例 | 用途 |
|---------|-----|------|
| {env}:{entity}:{id} | prod:product:12345 | 単一エンティティ |
| {env}:{entity}:list:{hash} | prod:product:list:abc123 | 一覧（クエリハッシュ） |
| {env}:session:{session_id} | prod:session:xyz789 | セッション |
| {env}:user:{user_id}:{type} | prod:user:100:cart | ユーザー固有データ |

### キー構成要素

| 要素 | 説明 |
|------|------|
| env | 環境識別子（prod/stg/dev） |
| entity | エンティティ名（product/category/user） |
| id | 一意識別子（数値ID or UUID） |
| hash | クエリパラメータのMD5ハッシュ（一覧用） |

## キャッシュ無効化戦略

### TTL（時間ベース）

| データ種別 | TTL | 理由 |
|-----------|-----|------|
| 商品マスタ | 1時間 | 価格変更は1日1回程度 |
| カテゴリ | 1時間 | 変更頻度が非常に低い |
| セッション | 24時間 | セキュリティとUXのバランス |
| 検索結果 | 5分 | 新商品追加を反映 |

### イベント駆動

| イベント | 無効化対象 | 処理 |
|---------|-----------|------|
| 商品更新 | prod:product:{id}, prod:product:list:* | 個別キー削除 + パターンマッチ削除 |
| 在庫変更 | prod:stock:{product_id} | 個別キー削除 |
| カテゴリ更新 | prod:category:* | パターンマッチ削除 |
| 価格一括変更 | prod:product:* | バッチ削除（オフピーク時） |

### バージョニング

| 対象 | 戦略 | 例 |
|------|------|-----|
| JS/CSS | ファイル名ハッシュ | main.abc123.js |
| 商品画像 | URLパラメータ | /images/product.jpg?v=20240115 |
| APIスキーマ | キーバージョン | prod:product:123:v2 |

## キャッシュウォームアップ

| タイミング | 対象 | 方法 |
|-----------|------|------|
| デプロイ後 | 人気商品TOP100 | バッチジョブで事前取得 |
| 毎朝5時 | カテゴリ一覧 | cronジョブ |
| キャッシュ障害復旧後 | 全カテゴリ、人気商品 | 復旧スクリプト実行 |

## 監視・運用

### メトリクス

| メトリクス | 閾値 | アラート条件 |
|-----------|------|-------------|
| ヒット率 | 85% | 5分間で80%未満が継続 |
| レイテンシ（p99） | 10ms | 1分間で20ms超過 |
| メモリ使用率 | 80% | 85%超過 |
| エビクション数 | 100/分 | 500/分超過 |

## 障害時の挙動

### キャッシュサーバー障害

| 状況 | 挙動 | 復旧手順 |
|------|------|----------|
| Redis障害 | DBへフォールバック（性能低下許容） | 1. アラート確認 2. ElastiCache自動復旧待ち 3. 必要に応じて手動フェイルオーバー |
| CDN障害 | オリジンサーバーへ直接アクセス | 1. CloudFrontステータス確認 2. Route53でオリジン切替 |

### サーキットブレーカー

| 項目 | 設定 |
|------|------|
| 失敗閾値 | 5回/10秒 |
| リセット時間 | 30秒 |
| ハーフオープン試行 | 3回 |

## セキュリティ考慮

| 項目 | 対策 |
|------|------|
| 機密データ | パスワード、カード情報はキャッシュ対象外 |
| 認証トークン | TTL 15分、HttpOnly Cookie |
| 個人情報 | ユーザー別キー + 暗号化（AES-256） |

## コスト最適化

| 施策 | 効果 |
|------|------|
| 圧縮（gzip/brotli） | 転送量50%削減 |
| 適切なTTL設定 | オリジンリクエスト70%削減 |
| リージョン選択 | レイテンシ20%改善 |
| リザーブドキャパシティ | Redis費用30%削減 |
```
